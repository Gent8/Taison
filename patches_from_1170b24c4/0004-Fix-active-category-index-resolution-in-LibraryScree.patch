From cb6d4b5314e9c2e619c1a9e19d9abccbc02d3960 Mon Sep 17 00:00:00 2001
From: Gent8 <deboordermounir@gmail.com>
Date: Sun, 19 Oct 2025 13:42:21 +0200
Subject: [PATCH 04/24] Fix active category index resolution in
 LibraryScreenModel to use coercedActiveCategoryIndex instead of
 activeCategoryIndex.

---
 .../java/eu/kanade/tachiyomi/ui/library/LibraryScreenModel.kt   | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/app/src/main/java/eu/kanade/tachiyomi/ui/library/LibraryScreenModel.kt b/app/src/main/java/eu/kanade/tachiyomi/ui/library/LibraryScreenModel.kt
index 8dd6411ec..c3d8143f7 100644
--- a/app/src/main/java/eu/kanade/tachiyomi/ui/library/LibraryScreenModel.kt
+++ b/app/src/main/java/eu/kanade/tachiyomi/ui/library/LibraryScreenModel.kt
@@ -131,7 +131,7 @@ class LibraryScreenModel(
                 }
                 .collectLatest { grouped ->
                     val categories = grouped.keys.toList()
-                    val preferredIndex = resolveActiveCategoryIndex(categories, state.value.activeCategoryIndex)
+                    val preferredIndex = resolveActiveCategoryIndex(categories, state.value.coercedActiveCategoryIndex)
                     val currentCategoryId = categories.getOrNull(preferredIndex)?.id ?: -1L
                     if (libraryPreferences.lastUsedCategoryId().get() != currentCategoryId) {
                         libraryPreferences.lastUsedCategoryId().set(currentCategoryId)
-- 
2.39.5 (Apple Git-154)

